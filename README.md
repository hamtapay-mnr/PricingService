# PricingService

## توضیحات
وظیفه این سرویس دریافت نرخ جهانی طلا و محاسبه قیمت لحظه ای بر اساس موجودی لحظه ای فروشگاه میباشد.
ویژگی های کلیدی این سرویس به شرح زیر میباشد:
- بروز بودن با نرخ جهانی طلا. با کمترین تعداد درخواست خارجی ممکن
- در صورتی که موجودی فروشگاه بین ۲۰٪تا۵۰٪‌ موجودی اولیه باشد قیمت ۵ درصد افزایش میابد
- در صورتی که موجودی فروشگاه کمتر از ۲۰٪ موجودی اولیه باشد قیمت ۱۰ درصد افزایش میابد
- روشی بهینه برای ذخیره و بازیابی قیمتهای بروزشده
- اطلاع رسانی به سایر بخش های سیستم در صورت تغییر قیمت
- مقیاس پذیر در مقابل ترافیک بالا

# نحوه راه اندازی
این سرویس به پکیج های زیر وابسته است
```
node v22
redis v5
```
برای نصب دستور زیر را اجرا کنید:
```
npm i
```

برای اجرا دستور زیر را اجرا کنید
```
node index.js
OR
npm start
```
سرویس هنگام استارت تلاش میکند که صف های مورد نیازش را بسازد.
```
Creating group:  new-order order_group
Creating group:  price-factor order_group
Start listening to queue: order_group new-order pricing_service
```
هر پیام صف ورودی باید کلیدهای زیر را شامل باشد:
```
currentInventory مقدار طلای باقی مانده قبل از برداشت
bought میزان خریداری شده
username نام کاربری خریدار
```
پس از پردازش سرویس پیامی با کلیدهای زیر را در صف خروجی میگذارد تا سرویس اطلاع رسانی بتواند از آن استفاده کند:
```
amount میزان خریداری شده
username نام کاربری خریدار
price قیمت خرید
remainingGoldPercentage درصد طلای باقی مانده در خزانه
```
به ازای هر سفارش جدیدی که دریافت شود سرویس لاگ زیر را ایجاد میکند.
```
Recieved new order:  { currentInventory: 1, bought: 1, username: 'milad' }
Send order to notifier:  { amount: 1, username: 'milad', price: 0, remainingGoldPercentage: 0 }
Processed new message:  1750193828246-0 order_group new-order
```

## نحوه استفاده
این سرویس رابطی برای ارسال درخواست مستقیم ندارد و تمام درخواست ها را از طریق رخداد صف ورودی دریافت میکند. پس فقط کافیست تا آن را اجرا کنید.   
ترتیب اجرای سرویس نسبت به سایر سرویس های سامانه مهم نیست.   
این سرویس state-less است و در صورت نیاز میتوانید چند نسخه از این سرویس بالا بیاورید.